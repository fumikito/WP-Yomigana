(function(){tinymce.create("tinymce.plugins.yomigana",{getInfo:function(){return{longname:"Yomigana",author:"Takahashi Fumiki",authorurl:"http://hametuha.co.jp",infourl:"http://hametuha.co.jp",version:"1.0"}},init:function(a,b){a.addCommand("Ruby",function(){a.windowManager.open({file:b+"/ruby.php",width:350,height:150,inline:1},{plugin_url:b})});a.addButton("ruby",{title:"yomigana_dlg.rubyTitle",cmd:"Ruby",image:b+"/img/ruby.gif"});a.addCommand("inlineQ",function(){a.windowManager.open({file:b+"/q.php",width:350,height:150,inline:1},{plugin_url:b})});a.addButton("q",{title:"yomigana_dlg.qTitle",cmd:"inlineQ",image:b+"/img/q.png"});a.addCommand("Small",function(){var a=this.selection.getNode();if(a.nodeName=="SMALL"){var b=document.createTextNode(a.innerHTML);this.dom.replace(b,a,false)}else if(this.selection.getContent().length>0){var c=this.dom.create("small");this.dom.setHTML(c,this.selection.getContent());this.selection.setNode(c)}});a.addButton("small",{title:"yomigana_dlg.smallTitle",cmd:"Small",image:b+"/img/small.png"});a.addCommand("DL",function(){var a=this.selection.getStart();var b=this.selection.getEnd();var c;if(this.dom.getParent(a,"DL")){c=this.dom.getParent(a,"DL")}else if(this.selection.getNode().tagName=="DL"){c=this.selection.getNode()}if(c){for(i=0,l=c.childNodes.length;i<l;i++){var d=document.createElement("p");d.innerHTML=c.childNodes[i].innerHTML;this.dom.insertAfter(d,c)}this.dom.remove(c)}else{if(this.selection.getContent().length>0){var e=this.dom.create("dl");if(a==b){this.dom.rename(a,"dt");e.appendChild(a);this.selection.setNode(e)}else{var f=a;var g=this.dom;for(i=0;true;){this.dom.add(e,i%2==0?"DT":"DD",{},f.innerHTML);i++;if(f==b||!(f=this.dom.getNext(f,function(a){return a&&g.isBlock(a)}))||i>100){break}}}this.selection.setNode(e)}}});a.addButton("dl",{title:"yomigana_dlg.dlTitle",cmd:"DL",image:b+"/img/dl.png"});a.onNodeChange.add(function(a,b,c,d){c=a.dom.getParent(c,"RUBY,SMALL,Q,DL");b.setDisabled("ruby",d);b.setActive("ruby",0);b.setDisabled("small",d);b.setActive("small",0);b.setDisabled("q",d);b.setActive("q",0);if(c){do{b.setDisabled(c.nodeName.toLowerCase(),0);b.setActive(c.nodeName.toLowerCase(),1)}while(c=c.parentNode)}})}});tinymce.PluginManager.add("yomigana",tinymce.plugins.yomigana)})()