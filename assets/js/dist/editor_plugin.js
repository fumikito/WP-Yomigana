tinymce.PluginManager.add("yomigana",function(e,t){function o(e,t){var o,n=e.selection.getNode();return n.nodeName==t.toUpperCase()?(o=document.createTextNode(n.innerHTML),e.dom.replace(o,n,!1)):e.selection.getContent().length>0&&(o=e.dom.create(t),e.dom.setHTML(o,e.selection.getContent()),e.selection.setNode(o)),o}e.addButton("dl",{image:WpYomigana.imageBase+"dl.png",type:"splitbutton",tooltip:WpYomigana.dl,stateSelector:"dl",menu:[{text:WpYomigana.dlToggle,data:"list"},{text:WpYomigana.dtToggle,data:"toggle"}],onselect:function(t){switch(t.control.settings.data){case"toggle":var o,n,a,i=e.selection.getNode(),d=e.dom.getParent(i,"dl");if(!d)return;if(e.dom.is(i,"dt"))o=i,n="dd";else if(e.dom.is(i,"dd"))o=i,n="dt";else if(a=e.dom.getParent(i,"dt",d))o=a,n="dd";else{if(!(a=e.dom.getParent(i,"dd",d)))return;o=a,n="dt"}e.dom.rename(o,n);break;default:e.execCommand("InsertDefinitionList")}},onclick:function(){e.execCommand("InsertDefinitionList")}}),e.addButton("small",{image:WpYomigana.imageBase+"small.png",tooltip:WpYomigana.small,stateSelector:"small",onClick:function(){o(e,"small")}}),e.addButton("cite",{image:WpYomigana.imageBase+"cite.png",tooltip:WpYomigana.cite,stateSelector:"cite",onClick:function(){o(e,"cite")}}),e.addButton("q",{image:WpYomigana.imageBase+"q.png",tooltip:WpYomigana.q,stateSelector:"q",onClick:function(){var t,o,n,a=e.selection.getNode(),i=!1,d="";e.dom.is(a,"q")?(t=a,d=jQuery(t).text()):(o=e.dom.getParent(a,"q"))?(t=o,d=jQuery(t).text()):(i=!0,d=e.selection.getContent()),n=e.dom.getAttrib(t,"cite",""),window.WpYomiganaHelper.q(WpYomigana.q,function(){jQuery(this).find("#citeText").val(d),jQuery(this).find("#citeFrom").val(n)},function(o,n){switch(n){case"set":var a=o.find("#citeText").val(),l=o.find("#citeFrom").val();if(i){var c=document.createElement("q");c.appendChild(document.createTextNode(a)),c.cite=l,e.selection.setNode(c)}else e.dom.setAttrib(t,"cite",l);break;case"remove":i||e.dom.replace(document.createTextNode(d),t,!1)}})}}),e.addButton("ruby",{image:WpYomigana.imageBase+"ruby.png",tooltip:WpYomigana.ruby,stateSelector:"ruby",onClick:function(){var t,o,n,a=e.selection.getNode(),i=!1,d="",l=!1;e.dom.is(a,"ruby")?(t=a,d=t.firstChild.nodeValue):(o=e.dom.getParent(a,"ruby"))?(t=o,d=t.firstChild.nodeValue):(i=!0,d=e.selection.getContent()),(n=e.dom.select("rt",t))&&(l=n[0]),window.WpYomiganaHelper.ruby(WpYomigana.ruby,function(){jQuery(this).find("#rubyBody").val(d),jQuery(this).find("#rubyText").val(l?l.firstChild.nodeValue:"")},function(o,n){switch(n){case"set":var a=o.find("#rubyBody").val(),c=o.find("#rubyText").val();if(i){var r=document.createElement("ruby");r.appendChild(document.createTextNode(a));var m=document.createElement("rt");m.appendChild(document.createTextNode(c)),r.appendChild(m),e.selection.setNode(r)}else t.firstChild.nodeValue=a,l.firstChild.nodeValue=c;break;case"remove":i||e.dom.replace(document.createTextNode(d),t,!1)}})}})});
//# sourceMappingURL=map/editor_plugin.js.map