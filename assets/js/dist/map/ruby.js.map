{"version":3,"sources":["ruby.js"],"names":["yomiganaManager","s","dom","target","onLoad","t","tinyMCEPopup","editor","selection","tinymce","isIE","moveToBookmark","ieBookmark","is","getNode","getParent","document","getElementById","value","firstChild","nodeValue","getNext","innerHTML","checked","disabled","getContent","focus","onSubmit","ruby_body","ruby_text","tag","createRuby","replace","setNode","close","onDelete","rubyTxt","createTextNode","parent","child","needRP","ruby","createElement","rb","appendChild","rt","rp1","rp2"],"mappings":"AAAA,GAAIA,kBACHC,EAAG,KACHC,IAAK,KACLC,OAAQ,KACRC,OAAQ,SAAUC,GACjBA,EAAEJ,EAAIK,aAAaC,OAAOC,UAC1BH,EAAEH,IAAMI,aAAaJ,IAClBO,QAAQC,MACVJ,aAAaC,OAAOC,UAAUG,eAAeL,aAAaC,OAAOK,YAG/DP,EAAEH,IAAIW,GAAGR,EAAEJ,EAAEa,UAAW,SAC1BT,EAAEF,OAASE,EAAEH,IAAIa,UAAUV,EAAEJ,EAAEa,UAAW,QAClCT,EAAEH,IAAIW,GAAGR,EAAEJ,EAAEa,UAAW,UAChCT,EAAEF,OAASE,EAAEJ,EAAEa,WAIbT,EAAEF,QACJa,SAASC,eAAe,QAAQC,MAAQb,EAAEF,OAAOgB,WAAWC,UAC5DJ,SAASC,eAAe,QAAQC,MAAQb,EAAEH,IAAImB,QAAQhB,EAAEF,OAAOgB,WAAY,MAAMG,UAC9EjB,EAAEH,IAAImB,QAAQhB,EAAEF,OAAOgB,WAAY,QAErCH,SAASC,eAAe,cAAcM,SAAU,GAEjDP,SAASC,eAAe,UAAUO,UAAW,GAE7CR,SAASC,eAAe,QAAQC,MAAQb,EAAEJ,EAAEwB,aAG7CT,SAASC,eAAe,QAAQS,SAGjCC,SAAU,SAAStB,GAElB,GAAIuB,GAAYZ,SAASC,eAAe,QAAQC,MAC5CW,EAAYb,SAASC,eAAe,QAAQC,MAC5CY,EAAM9B,gBAAgB+B,WAAWH,EAAWC,EAAWb,SAASC,eAAe,cAAcM,QAC9Fd,SAAQC,MACVJ,aAAaC,OAAOC,UAAUG,eAAeL,aAAaC,OAAOK,YAE/DP,EAAEF,OAEJE,EAAEH,IAAI8B,QAAQF,EAAKzB,EAAEF,QAGrBE,EAAEJ,EAAEgC,QAAQH,GAEbxB,aAAa4B,SAGdC,SAAU,SAAS9B,GAElB,GAAGA,EAAEF,OAAO,CACRM,QAAQC,MACVJ,aAAaC,OAAOC,UAAUG,eAAeL,aAAaC,OAAOK,WAElE,IAAIwB,GAAU/B,EAAEF,OAAOgB,WAAWC,SAClCf,GAAEH,IAAI8B,QAAQhB,SAASqB,eAAeD,GAAU/B,EAAEF,QAAQ,GAE3DG,aAAa4B,SAGdH,WAAY,SAASO,EAAQC,EAAOC,GACnC,GAAIC,GAAOzB,SAAS0B,cAAc,QAC9BC,EAAK3B,SAASqB,eAAeC,EACjCG,GAAKG,YAAYD,EACjB,IAAIE,GAAK7B,SAAS0B,cAAc,KAEhC,IADAG,EAAGvB,UAAYiB,EACZC,EAAO,CACT,GAAIM,GAAM9B,SAAS0B,cAAc,KACjCI,GAAIxB,UAAY,GAChB,IAAIyB,GAAM/B,SAAS0B,cAAc,KACjCK,GAAIzB,UAAY,IAChBmB,EAAKG,YAAYE,GACjBL,EAAKG,YAAYC,GACjBJ,EAAKG,YAAYG,OAEjBN,GAAKG,YAAYC,EAElB,OAAOJ","file":"ruby.js","sourcesContent":["var yomiganaManager = {\n\ts: null,\n\tdom: null,\n\ttarget: null,\n\tonLoad: function (t){\n\t\tt.s = tinyMCEPopup.editor.selection;\n\t\tt.dom = tinyMCEPopup.dom;\n\t\tif(tinymce.isIE){\n\t\t\ttinyMCEPopup.editor.selection.moveToBookmark(tinyMCEPopup.editor.ieBookmark);\n\t\t}\n\t\t//すでにrubyタグがつけられている場合はrbタグを取得\n\t\tif(t.dom.is(t.s.getNode(), \"RT,RP\")){\n\t\t\tt.target = t.dom.getParent(t.s.getNode(), 'RUBY');\n\t\t}else if(t.dom.is(t.s.getNode(), \"RUBY\")){\n\t\t\tt.target = t.s.getNode();\n\t\t}\n\t\t\n\t\t//更新と新規の場合\n\t\tif(t.target){\n\t\t\tdocument.getElementById(\"moji\").value = t.target.firstChild.nodeValue; //親文字の取得\n\t\t\tdocument.getElementById(\"yomi\").value = t.dom.getNext(t.target.firstChild, 'rt').innerHTML; //ルビ文字\n\t\t\tif(t.dom.getNext(t.target.firstChild, 'rp')){\n\t\t\t\t//rpタグのサポートにチェック\n\t\t\t\tdocument.getElementById('need-paren').checked = true;\n\t\t\t}\n\t\t\tdocument.getElementById(\"delete\").disabled = false;\n\t\t}else{\n\t\t\tdocument.getElementById(\"moji\").value = t.s.getContent();\n\t\t}\n\t\t//フォームにフォーカスを当てる\n\t\tdocument.getElementById(\"yomi\").focus();\n\t},\n\t\n\tonSubmit: function(t){\n\t\t//ルビ用文字の取得\n\t\tvar ruby_body = document.getElementById(\"moji\").value;\n\t\tvar ruby_text = document.getElementById(\"yomi\").value;\n\t\tvar tag = yomiganaManager.createRuby(ruby_body, ruby_text, document.getElementById('need-paren').checked);\n\t\tif(tinymce.isIE){\n\t\t\ttinyMCEPopup.editor.selection.moveToBookmark(tinyMCEPopup.editor.ieBookmark);\n\t\t}\n\t\tif(t.target){\n\t\t\t//すでにルビを作成済みの場合\n\t\t\tt.dom.replace(tag, t.target);\n\t\t}else{\n\t\t\t//ルビ新規作成の場合\n\t\t\tt.s.setNode(tag);\n\t\t}\n\t\ttinyMCEPopup.close();\n\t},\n\t\n\tonDelete: function(t){\n\t\t//タグを脱がせる\n\t\tif(t.target){\n\t\t\tif(tinymce.isIE){\n\t\t\t\ttinyMCEPopup.editor.selection.moveToBookmark(tinyMCEPopup.editor.ieBookmark);\n\t\t\t}\n\t\t\tvar rubyTxt = t.target.firstChild.nodeValue;\n\t\t\tt.dom.replace(document.createTextNode(rubyTxt), t.target, false);\n\t\t}\n\t\ttinyMCEPopup.close();\n\t},\n\t\n\tcreateRuby: function(parent, child, needRP){\n\t\tvar ruby = document.createElement('ruby');\n\t\tvar rb = document.createTextNode(parent);\n\t\truby.appendChild(rb);\n\t\tvar rt = document.createElement('rt');\n\t\trt.innerHTML = child;\n\t\tif(needRP){\n\t\t\tvar rp1 = document.createElement('rp');\n\t\t\trp1.innerHTML = '(';\n\t\t\tvar rp2 = document.createElement('rp');\n\t\t\trp2.innerHTML = ')';\n\t\t\truby.appendChild(rp1);\n\t\t\truby.appendChild(rt);\n\t\t\truby.appendChild(rp2);\n\t\t}else{\n\t\t\truby.appendChild(rt);\n\t\t}\n\t\treturn ruby;\n\t}\n};"],"sourceRoot":"/source/"}