{"version":3,"sources":["ruby.js"],"names":["yomiganaManager","s","dom","t","target","editor","selection","onLoad","tinyMCEPopup","tinymce","moveToBookmark","ieBookmark","is","getNode","getParent","document","getElementById","value","firstChild","nodeValue","getNext","innerHTML","checked","disabled","getContent","focus","onSubmit","ruby_text","ruby_body","createRuby","tag","setNode","onDelete","isIE","replace","createTextNode","rubyTxt","parent","child","needRP","ruby","createElement","rb","appendChild","rt","rp1","rp2"],"mappings":"aAAA,IAAIA,iBACHC,EAAG,KADJC,IAAIF,KACHC,OADqB,KAErBC,OAAK,SAFgBC,GAGrBC,EAAAA,EAAAA,aAHqBC,OAAAC,UAIrBC,EAAAA,IAAQC,aAAAN,IACPO,QAAMD,MACNL,aAAQK,OAAaN,UAArBQ,eAAAF,aAAAH,OAAAM,YAGCR,EAAAD,IAAAU,GAAAT,EAAAF,EAAAY,UAAA,SACDV,EAAAC,OAAAD,EAAAD,IAAAY,UAAAX,EAAAF,EAAAY,UAAA,QACGV,EAAMS,IAAKX,GAAEY,EAAAA,EAAAA,UAAW,UAC1BV,EAAEC,OAASD,EAAED,EAAAA,WAMXC,EAAEC,QADLW,SAAAC,eAAA,QAAAC,MAAAd,EAAAC,OAAAc,WAAAC,UACAJ,SAAKX,eAAO,QAAAa,MAAAd,EAAAD,IAAAkB,QAAAjB,EAAAC,OAAAc,WAAA,MAAAG,UACXN,EAAAA,IAASC,QAAAA,EAAAA,OAAeE,WAAxB,QAEAH,SAASK,eAAUhB,cAAmBkB,SAAM,GAE3CP,SAAAA,eAAA,UAAwBQ,UAAcD,GAEvCP,SAASC,eAAe,QAAxBC,MAAkCM,EAAlCtB,EAAAuB,aAGAT,SAAAC,eAAA,QAAAS,SAGDC,SA/BoB,SAAAvB,GAiCrBuB,IAAAA,EAAUX,SAAAC,eAAW,QAAAC,MACpBU,EAAAZ,SAAAC,eAAA,QAAAC,MACIW,EAAAA,gBAAqBZ,WAAAA,EAAuBC,EAAhDF,SAAAC,eAAA,cAAAM,SACAb,QAAIkB,MACJnB,aAAUR,OAAAA,UAAgB6B,eAAhBrB,aAAiDO,OAAAA,YAE1DP,EAAAA,OAEDL,EAAAD,IAAKE,QAAO0B,EAAA3B,EAAAC,QAAZD,EAAAF,EAAA8B,QAGKD,GAEJ3B,aAAY2B,SAGbE,SAjDoB,SAAA7B,GAmDrB6B,GAAAA,EAAAA,OAAU,CACTvB,QAAAwB,MACAzB,aAAYH,OAAAC,UAAAI,eAAAF,aAAAH,OAAAM,YAEVH,IAAAA,EAAaH,EAAAA,OAAOC,WAAUI,UAC9BP,EAAAD,IAAAgC,QAAAnB,SAAAoB,eAAAC,GAAAjC,EAAAC,QAAA,GAEDD,aAAM+B,SAGPL,WA7DoB,SAAAQ,EAAAC,EAAAC,GAgEpB,IAAIC,EAAOzB,SAAS0B,cAAc,QADnCZ,EAAAA,SAAYM,eAASE,GACpBG,EAAIA,YAAOzB,GACX,IAAI2B,EAAK3B,SAASoB,cAAT,MAET,GADAK,EAAAA,UAAKG,EACLJ,EAASxB,CACT6B,IAAGvB,EAAAA,SAAHoB,cAAA,MACAI,EAAGN,UAAO,IACT,IAAIM,EAAM9B,SAAS0B,cAAc,MACjCI,EAAIxB,UAAY,IAChBmB,EAAIM,YAAM/B,GACV+B,EAAIzB,YAAYuB,GAChBJ,EAAKG,YAAYE,QAEjBL,EAAKG,YAAYG,GAEjBN,OAAKG","file":"../ruby.js","sourcesContent":["var yomiganaManager = {\n\ts: null,\n\tdom: null,\n\ttarget: null,\n\tonLoad: function (t){\n\t\tt.s = tinyMCEPopup.editor.selection;\n\t\tt.dom = tinyMCEPopup.dom;\n\t\tif(tinymce.isIE){\n\t\t\ttinyMCEPopup.editor.selection.moveToBookmark(tinyMCEPopup.editor.ieBookmark);\n\t\t}\n\t\t//すでにrubyタグがつけられている場合はrbタグを取得\n\t\tif(t.dom.is(t.s.getNode(), \"RT,RP\")){\n\t\t\tt.target = t.dom.getParent(t.s.getNode(), 'RUBY');\n\t\t}else if(t.dom.is(t.s.getNode(), \"RUBY\")){\n\t\t\tt.target = t.s.getNode();\n\t\t}\n\t\t\n\t\t//更新と新規の場合\n\t\tif(t.target){\n\t\t\tdocument.getElementById(\"moji\").value = t.target.firstChild.nodeValue; //親文字の取得\n\t\t\tdocument.getElementById(\"yomi\").value = t.dom.getNext(t.target.firstChild, 'rt').innerHTML; //ルビ文字\n\t\t\tif(t.dom.getNext(t.target.firstChild, 'rp')){\n\t\t\t\t//rpタグのサポートにチェック\n\t\t\t\tdocument.getElementById('need-paren').checked = true;\n\t\t\t}\n\t\t\tdocument.getElementById(\"delete\").disabled = false;\n\t\t}else{\n\t\t\tdocument.getElementById(\"moji\").value = t.s.getContent();\n\t\t}\n\t\t//フォームにフォーカスを当てる\n\t\tdocument.getElementById(\"yomi\").focus();\n\t},\n\t\n\tonSubmit: function(t){\n\t\t//ルビ用文字の取得\n\t\tvar ruby_body = document.getElementById(\"moji\").value;\n\t\tvar ruby_text = document.getElementById(\"yomi\").value;\n\t\tvar tag = yomiganaManager.createRuby(ruby_body, ruby_text, document.getElementById('need-paren').checked);\n\t\tif(tinymce.isIE){\n\t\t\ttinyMCEPopup.editor.selection.moveToBookmark(tinyMCEPopup.editor.ieBookmark);\n\t\t}\n\t\tif(t.target){\n\t\t\t//すでにルビを作成済みの場合\n\t\t\tt.dom.replace(tag, t.target);\n\t\t}else{\n\t\t\t//ルビ新規作成の場合\n\t\t\tt.s.setNode(tag);\n\t\t}\n\t\ttinyMCEPopup.close();\n\t},\n\t\n\tonDelete: function(t){\n\t\t//タグを脱がせる\n\t\tif(t.target){\n\t\t\tif(tinymce.isIE){\n\t\t\t\ttinyMCEPopup.editor.selection.moveToBookmark(tinyMCEPopup.editor.ieBookmark);\n\t\t\t}\n\t\t\tvar rubyTxt = t.target.firstChild.nodeValue;\n\t\t\tt.dom.replace(document.createTextNode(rubyTxt), t.target, false);\n\t\t}\n\t\ttinyMCEPopup.close();\n\t},\n\t\n\tcreateRuby: function(parent, child, needRP){\n\t\tvar ruby = document.createElement('ruby');\n\t\tvar rb = document.createTextNode(parent);\n\t\truby.appendChild(rb);\n\t\tvar rt = document.createElement('rt');\n\t\trt.innerHTML = child;\n\t\tif(needRP){\n\t\t\tvar rp1 = document.createElement('rp');\n\t\t\trp1.innerHTML = '(';\n\t\t\tvar rp2 = document.createElement('rp');\n\t\t\trp2.innerHTML = ')';\n\t\t\truby.appendChild(rp1);\n\t\t\truby.appendChild(rt);\n\t\t\truby.appendChild(rp2);\n\t\t}else{\n\t\t\truby.appendChild(rt);\n\t\t}\n\t\treturn ruby;\n\t}\n};"]}