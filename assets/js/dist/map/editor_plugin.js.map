{"version":3,"sources":["editor_plugin.js"],"names":["tinymce","PluginManager","add","editor","url","WrapWithSimpleTag","tagName","newDom","target","selection","getNode","nodeName","toUpperCase","document","createTextNode","innerHTML","dom","replace","getContent","length","create","setHTML","setNode","addButton","image","WpYomigana","imageBase","type","tooltip","dl","stateSelector","menu","text","dlToggle","data","dtToggle","onselect","e","control","settings","parent","node","getParent","is","rename","execCommand","onclick","small","onClick","cite","q","s","jQuery","getAttrib","window","WpYomiganaHelper","this","find","val","$modal","action","origText","citeText","newQ","createElement","appendChild","setAttrib","ruby","rts","rt","firstChild","nodeValue","select","rubyBody","rubyText","newRuby","newRt"],"mappings":"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","file":"editor_plugin.js","sourcesContent":["/**\n * TinyMCE plugin for WP-Yomigana\n *\n * @author Hametuha inc.\n * @package wp-yomigana\n */\n\n/*global tinymce: true*/\n/*global WpYomigana: true*/\n\ntinymce.PluginManager.add('yomigana', function(editor, url) {\n\n    /**\n     * Wrap string with single value\n     * @param editor\n     * @param tagName\n     * @return {Object}\n     */\n    function WrapWithSimpleTag(editor, tagName){\n        var target = editor.selection.getNode(),\n            newDom;\n        if( target.nodeName == tagName.toUpperCase() ){\n            // If this node is small, unwrap.\n            newDom = document.createTextNode(target.innerHTML);\n            editor.dom.replace(newDom, target, false);\n        }else if( editor.selection.getContent().length > 0 ){\n            // If letters selected, wrap it\n            newDom = editor.dom.create(tagName);\n            editor.dom.setHTML(newDom, editor.selection.getContent());\n            editor.selection.setNode(newDom);\n        }\n        return newDom;\n    }\n\n\n\n    //\n    // DL Button\n    //\n    // -----------------------\n    //\n\n    editor.addButton('dl', {\n        image: WpYomigana.imageBase + 'dl.png',\n        type: 'splitbutton',\n        tooltip: WpYomigana.dl,\n        stateSelector: 'dl',\n        menu: [{\n                   text: WpYomigana.dlToggle,\n                   data: 'list'\n               },\n               {\n                    text: WpYomigana.dtToggle,\n                    data: 'toggle'\n               }],\n        onselect: function(e) {\n            switch( e.control.settings.data ){\n                case 'toggle':\n                    // Switch dt to dd, dd to dt.\n                    var node = editor.selection.getNode(),\n                        dl   = editor.dom.getParent(node, 'dl'),\n                        target, tagName, parent;\n                    if( !dl ){\n                        return;\n                    }\n                    if( editor.dom.is(node, 'dt') ){\n                        target = node;\n                        tagName = 'dd';\n                    }else if( editor.dom.is(node, 'dd') ){\n                        target = node;\n                        tagName = 'dt';\n                    }else if( ( parent = editor.dom.getParent(node, 'dt', dl)) ){\n                        target = parent;\n                        tagName = 'dd';\n                    }else if( ( parent = editor.dom.getParent(node, 'dd', dl)) ){\n                        target = parent;\n                        tagName = 'dt';\n                    }else{\n                        // This is not dl\n                        return;\n                    }\n                    editor.dom.rename(target, tagName);\n                    break;\n                default:\n                    editor.execCommand('InsertDefinitionList');\n                    break;\n            }\n        },\n        onclick: function() {\n            editor.execCommand('InsertDefinitionList');\n        }\n    });\n\n    //\n    // small button\n    //\n    // -----------------------\n    //\n    editor.addButton('small', {\n        image: WpYomigana.imageBase + 'small.png',\n        tooltip: WpYomigana.small,\n        stateSelector: 'small',\n        onClick: function(){\n            WrapWithSimpleTag(editor, 'small');\n        }\n    });\n\n\n    //\n    // Cite Button\n    //\n    // -----------------------\n    //\n    editor.addButton('cite', {\n        image: WpYomigana.imageBase + 'cite.png',\n        tooltip: WpYomigana.cite,\n        stateSelector: 'cite',\n        onClick: function(){\n            WrapWithSimpleTag(editor, 'cite');\n        }\n    });\n\n    //\n    // q Button\n    //\n    // -----------------------\n    //\n    editor.addButton('q', {\n        image: WpYomigana.imageBase + 'q.png',\n        tooltip: WpYomigana.q,\n        stateSelector: 'q',\n        onClick: function(){\n            var s = editor.selection.getNode(),\n                create = false,\n                text = '',\n                q, parent, cite;\n            if( editor.dom.is(s, \"q\") ){\n                q = s;\n                text = jQuery(q).text();\n            }else if( (parent = editor.dom.getParent(s, 'q') ) ){\n                q = parent;\n                text = jQuery(q).text();\n            }else{\n                create = true;\n                text = editor.selection.getContent();\n            }\n            cite = editor.dom.getAttrib(q, 'cite', '');\n            window.WpYomiganaHelper.q(WpYomigana.q, function(){\n                jQuery(this).find('#citeText').val(text);\n                jQuery(this).find('#citeFrom').val(cite);\n            }, function($modal, action){\n                switch( action ){\n                    case 'set':\n                        var origText = $modal.find('#citeText').val(),\n                            citeText = $modal.find('#citeFrom').val();\n                        if( create ){\n                            // This is first\n                            var newQ = document.createElement('q');\n                            newQ.appendChild(document.createTextNode(origText));\n                            newQ.cite = citeText;\n                            editor.selection.setNode(newQ);\n                        }else{\n                            // Already exist\n                            editor.dom.setAttrib(q, 'cite', citeText);\n                        }\n                        break;\n                    case 'remove':\n                        if( !create ){\n                            // Remove tag\n                            editor.dom.replace(document.createTextNode(text), q, false);\n                        }\n                        break;\n                    default:\n                        // Do nothing\n                        break;\n                }\n            });\n        }\n    });\n\n\n\n    //\n    // ruby Button\n    //\n    // -----------------------\n    //\n    editor.addButton('ruby', {\n        image: WpYomigana.imageBase + 'ruby.png',\n        tooltip: WpYomigana.ruby,\n        stateSelector: 'ruby',\n        onClick: function(){\n            var s = editor.selection.getNode(),\n                create = false,\n                text = '',\n                ruby, parent, rt = false, rts;\n            if( editor.dom.is(s, \"ruby\") ){\n                ruby = s;\n                text = ruby.firstChild.nodeValue;\n            }else if( (parent = editor.dom.getParent(s, 'ruby') ) ){\n                ruby = parent;\n                text = ruby.firstChild.nodeValue;\n            }else{\n                create = true;\n                text = editor.selection.getContent();\n            }\n            if( rts = editor.dom.select('rt', ruby) ){\n                rt = rts[0];\n            }\n            window.WpYomiganaHelper.ruby(WpYomigana.ruby, function(){\n                jQuery(this).find('#rubyBody').val(text);\n                jQuery(this).find('#rubyText').val(rt ? rt.firstChild.nodeValue : '');\n            }, function($modal, action){\n                switch( action ){\n                    case 'set':\n                        var rubyBody = $modal.find('#rubyBody').val(),\n                            rubyText = $modal.find('#rubyText').val();\n                        if( create ){\n                            // This is first\n                            var newRuby = document.createElement('ruby');\n                            newRuby.appendChild(document.createTextNode(rubyBody));\n                            var newRt = document.createElement('rt');\n                            newRt.appendChild(document.createTextNode(rubyText));\n                            newRuby.appendChild(newRt);\n                            editor.selection.setNode(newRuby);\n                        }else{\n                            // Already exist\n                            ruby.firstChild.nodeValue = rubyBody;\n                            rt.firstChild.nodeValue = rubyText;\n                        }\n                        break;\n                    case 'remove':\n                        if( !create ){\n                            // Remove tag\n                            editor.dom.replace(document.createTextNode(text), ruby, false);\n                        }\n                        break;\n                    default:\n                        // Do nothing\n                        break;\n                }\n            });\n        }\n    });\n});\n"],"sourceRoot":"/source/"}