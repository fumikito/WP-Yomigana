{"version":3,"sources":["editor_plugin.js"],"names":["tinymce","PluginManager","add","editor","url","WrapWithSimpleTag","tagName","newDom","target","selection","getNode","nodeName","toUpperCase","document","createTextNode","innerHTML","dom","replace","getContent","length","create","setHTML","setNode","addButton","image","WpYomigana","imageBase","type","tooltip","dl","stateSelector","menu","text","dlToggle","data","dtToggle","onselect","e","control","settings","parent","node","getParent","is","rename","execCommand","onclick","small","onClick","cite","q","window","prompt","qDesc","getAttrib"],"mappings":"AAUAA,QAAQC,cAAcC,IAAI,WAAY,SAASC,EAAQC,GAQnD,QAASC,GAAkBF,EAAQG,GAC/B,GACIC,GADAC,EAASL,EAAOM,UAAUC,SAY9B,OAVIF,GAAOG,UAAYL,EAAQM,eAE3BL,EAASM,SAASC,eAAeN,EAAOO,WACxCZ,EAAOa,IAAIC,QAAQV,EAAQC,GAAQ,IAC7BL,EAAOM,UAAUS,aAAaC,OAAS,IAE7CZ,EAASJ,EAAOa,IAAII,OAAOd,GAC3BH,EAAOa,IAAIK,QAAQd,EAAQJ,EAAOM,UAAUS,cAC5Cf,EAAOM,UAAUa,QAAQf,IAEtBA,EAWXJ,EAAOoB,UAAU,MACbC,MAAOC,WAAWC,UAAY,SAC9BC,KAAM,cACNC,QAASH,WAAWI,GACpBC,cAAe,KACfC,OACWC,KAAMP,WAAWQ,SACjBC,KAAM,SAGLF,KAAMP,WAAWU,SACjBD,KAAM,WAElBE,SAAU,SAASC,GACf,OAAQA,EAAEC,QAAQC,SAASL,MACvB,IAAK,SAED,GAEI1B,GAAQF,EAASkC,EAFjBC,EAAOtC,EAAOM,UAAUC,UACxBmB,EAAO1B,EAAOa,IAAI0B,UAAUD,EAAM,KAEtC,KAAKZ,EACD,MAEJ,IAAI1B,EAAOa,IAAI2B,GAAGF,EAAM,MACpBjC,EAASiC,EACTnC,EAAU,SACR,IAAIH,EAAOa,IAAI2B,GAAGF,EAAM,MAC1BjC,EAASiC,EACTnC,EAAU,SACR,IAAMkC,EAASrC,EAAOa,IAAI0B,UAAUD,EAAM,KAAMZ,GAClDrB,EAASgC,EACTlC,EAAU,SACR,CAAA,KAAMkC,EAASrC,EAAOa,IAAI0B,UAAUD,EAAM,KAAMZ,IAKlD,MAJArB,GAASgC,EACTlC,EAAU,KAKdH,EAAOa,IAAI4B,OAAOpC,EAAQF,EAC1B,MACJ,SACIH,EAAO0C,YAAY,0BAI/BC,QAAS,WACL3C,EAAO0C,YAAY,2BAS3B1C,EAAOoB,UAAU,SACbC,MAAOC,WAAWC,UAAY,YAC9BE,QAASH,WAAWsB,MACpBjB,cAAe,QACfkB,QAAS,WACL3C,EAAkBF,EAAQ,YAUlCA,EAAOoB,UAAU,QACbC,MAAOC,WAAWC,UAAY,WAC9BE,QAASH,WAAWwB,KACpBnB,cAAe,OACfkB,QAAS,WACL3C,EAAkBF,EAAQ,WAUlCA,EAAOoB,UAAU,KACbC,MAAOC,WAAWC,UAAY,QAC9BE,QAASH,WAAWyB,EACpBpB,cAAe,IACfkB,QAAS,WACL,GAEIR,GAAQS,EAFRC,EAAI/C,EAAOM,UAAUC,UACrBU,GAAS,CAETjB,GAAOa,IAAI2B,GAAGO,EAAG,QAEVV,EAASrC,EAAOa,IAAI0B,UAAUD,KAAM,MAC3CS,EAAIV,EAEJpB,GAAS,GAEb6B,EAAOE,OAAOC,OAAO3B,WAAW4B,MAAOJ,EAAM9C,EAAOa,IAAIsC,UAAUJ,EAAG,QAAS,KAC9E7C,EAAkBF,EAAQ","file":"editor_plugin.js","sourcesContent":["/**\n * TinyMCE plugin for WP-Yomigana\n *\n * @author Hametuha inc.\n * @package wp-yomigana\n */\n\n/*global tinymce: true*/\n/*global WpYomigana: true*/\n\ntinymce.PluginManager.add('yomigana', function(editor, url) {\n\n    /**\n     * Wrap string with single value\n     * @param editor\n     * @param tagName\n     * @return {Object}\n     */\n    function WrapWithSimpleTag(editor, tagName){\n        var target = editor.selection.getNode(),\n            newDom;\n        if( target.nodeName == tagName.toUpperCase() ){\n            // If this node is small, unwrap.\n            newDom = document.createTextNode(target.innerHTML);\n            editor.dom.replace(newDom, target, false);\n        }else if( editor.selection.getContent().length > 0 ){\n            // If letters selected, wrap it\n            newDom = editor.dom.create(tagName);\n            editor.dom.setHTML(newDom, editor.selection.getContent());\n            editor.selection.setNode(newDom);\n        }\n        return newDom;\n    }\n\n\n\n    //\n    // DL Button\n    //\n    // -----------------------\n    //\n\n    editor.addButton('dl', {\n        image: WpYomigana.imageBase + 'dl.png',\n        type: 'splitbutton',\n        tooltip: WpYomigana.dl,\n        stateSelector: 'dl',\n        menu: [{\n                   text: WpYomigana.dlToggle,\n                   data: 'list'\n               },\n               {\n                    text: WpYomigana.dtToggle,\n                    data: 'toggle'\n               }],\n        onselect: function(e) {\n            switch( e.control.settings.data ){\n                case 'toggle':\n                    // Switch dt to dd, dd to dt.\n                    var node = editor.selection.getNode(),\n                        dl   = editor.dom.getParent(node, 'dl'),\n                        target, tagName, parent;\n                    if( !dl ){\n                        return;\n                    }\n                    if( editor.dom.is(node, 'dt') ){\n                        target = node;\n                        tagName = 'dd';\n                    }else if( editor.dom.is(node, 'dd') ){\n                        target = node;\n                        tagName = 'dt';\n                    }else if( ( parent = editor.dom.getParent(node, 'dt', dl)) ){\n                        target = parent;\n                        tagName = 'dd';\n                    }else if( ( parent = editor.dom.getParent(node, 'dd', dl)) ){\n                        target = parent;\n                        tagName = 'dt';\n                    }else{\n                        // This is not dl\n                        return;\n                    }\n                    editor.dom.rename(target, tagName);\n                    break;\n                default:\n                    editor.execCommand('InsertDefinitionList');\n                    break;\n            }\n        },\n        onclick: function() {\n            editor.execCommand('InsertDefinitionList');\n        }\n    });\n\n    //\n    // small button\n    //\n    // -----------------------\n    //\n    editor.addButton('small', {\n        image: WpYomigana.imageBase + 'small.png',\n        tooltip: WpYomigana.small,\n        stateSelector: 'small',\n        onClick: function(){\n            WrapWithSimpleTag(editor, 'small');\n        }\n    });\n\n\n    //\n    // Cite Button\n    //\n    // -----------------------\n    //\n    editor.addButton('cite', {\n        image: WpYomigana.imageBase + 'cite.png',\n        tooltip: WpYomigana.cite,\n        stateSelector: 'cite',\n        onClick: function(){\n            WrapWithSimpleTag(editor, 'cite');\n        }\n    });\n\n    //\n    // q Button\n    //\n    // -----------------------\n    //\n\n    editor.addButton('q', {\n        image: WpYomigana.imageBase + 'q.png',\n        tooltip: WpYomigana.q,\n        stateSelector: 'q',\n        onClick: function(){\n            var q = editor.selection.getNode(),\n                create = false,\n                parent, cite;\n            if( editor.dom.is(q, \"q\") ){\n\n            }else if( (parent = editor.dom.getParent(node, 'q') ) ){\n                q = parent;\n            }else{\n                create = true;\n            }\n            cite = window.prompt(WpYomigana.qDesc, cite, editor.dom.getAttrib(q, 'title', ''));\n            WrapWithSimpleTag(editor, 'q');\n        }\n    });\n\n});\n"],"sourceRoot":"/source/"}