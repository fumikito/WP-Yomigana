{"version":3,"sources":["_editor_plugin.js"],"names":["tinymce","create","getInfo","longname","author","authorurl","infourl","init","editor","url","addCommand","focus","selection","getBookmark","ieBookmark","file","width","height","inline","plugin_url","cmd","addButton","image","windowManager","open","target","nodeName","this","getNode","createTextNode","txt","document","getContent","length","dom","replace","newDom","setNode","setHTML","endNode","wrapper","getStart","getParent","startNode","tagName","p","innerHTML","childNodes","i","l","insertAfter","remove","dl","appendChild","currentNode","d","getNext","node","isBlock","setDisabled","add","e","g","f","setActive","parentNode","toLowerCase","PluginManager","plugins","yomigana"],"mappings":"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","file":"../_editor_plugin.js","sourcesContent":["(function(){\n\t\n\t\n\ttinymce.create(\"tinymce.plugins.yomigana\",{\n\t\t\n\t\tgetInfo:function(){\n\t\t\treturn{\n\t\t\t\tlongname:\"Yomigana\",\n\t\t\t\tauthor:\"Takahashi Fumiki\",\n\t\t\t\tauthorurl:\"http://takahashifumiki.com\",\n\t\t\t\tinfourl:\"https://wordpress.org/plugins/wp-yomigana/\",\n\t\t\t\tversion:\"1.0\"\n\t\t\t};\n\t\t},\n\t\t\n\t\tinit:function(editor,url){\n\t\t\t//ルビ\n\t\t\teditor.addCommand(\"Ruby\",function(){\n\t\t\t\teditor.focus();\n\t\t\t\teditor.ieBookmark = editor.selection.getBookmark(1);\n\t\t\t\teditor.windowManager.open(\n\t\t\t\t\t{\n\t\t\t\t\t\tfile: url + \"/ruby.php\",\n\t\t\t\t\t\twidth: 350,\n\t\t\t\t\t\theight:150,\n\t\t\t\t\t\tinline: 1\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tplugin_url: url\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t});\n\t\t\teditor.addButton(\"ruby\",{\n\t\t\t\ttitle:\"yomigana_dlg.rubyTitle\",\n\t\t\t\tcmd:\"Ruby\",\n\t\t\t\timage: url + \"/img/ruby.gif\"\n\t\t\t});\n\t\t\t//qタグ\n\t\t\teditor.addCommand('inlineQ', function(){\n\t\t\t\teditor.focus();\n\t\t\t\teditor.ieBookmark = editor.selection.getBookmark(1);\n\t\t\t\teditor.windowManager.open({\n\t\t\t\t\tfile: url + '/q.php',\n\t\t\t\t\twidth: 350,\n\t\t\t\t\theight: 150,\n\t\t\t\t\tinline: 1\n\t\t\t\t},{\n\t\t\t\t\tplugin_url: url\n\t\t\t\t});\n\t\t\t});\n\t\t\teditor.addButton(\"q\", {\n\t\t\t\ttitle: \"yomigana_dlg.qTitle\",\n\t\t\t\tcmd: 'inlineQ',\n\t\t\t\timage: url + '/img/q.png'\n\t\t\t});\n\t\t\t//small\n\t\t\teditor.addCommand(\"Small\", function(){\n\t\t\t\tvar target = this.selection.getNode();\n\t\t\t\tif(target.nodeName == 'SMALL'){\n\t\t\t\t\t//ノード名がSmallだったら外す\n\t\t\t\t\tvar txt = document.createTextNode(target.innerHTML);\n\t\t\t\t\tthis.dom.replace(txt, target, false);\n\t\t\t\t}else if(this.selection.getContent().length > 0){\n\t\t\t\t\t//一文字以上選択されていたらsmallでWrapする\n\t\t\t\t\tvar newDom = this.dom.create('small');\n\t\t\t\t\tthis.dom.setHTML(newDom, this.selection.getContent());\n\t\t\t\t\tthis.selection.setNode(newDom);\n\t\t\t\t}\n\t\t\t});\n\t\t\teditor.addButton(\"small\",{\n\t\t\t\ttitle: \"yomigana_dlg.smallTitle\",\n\t\t\t\tcmd: 'Small',\n\t\t\t\timage: url + '/img/small.png'\n\t\t\t});\n\t\t\teditor.addCommand('DL', function(){\n\t\t\t\tvar startNode = this.selection.getStart();\n\t\t\t\tvar endNode = this.selection.getEnd();\n\t\t\t\tvar wrapper;\n\t\t\t\tif(this.dom.getParent(startNode, 'DL')){\n\t\t\t\t\twrapper = this.dom.getParent(startNode, 'DL');\n\t\t\t\t}else if(this.selection.getNode().tagName == 'DL'){\n\t\t\t\t\twrapper = this.selection.getNode();\n\t\t\t\t}\n\t\t\t\tif(wrapper){\n\t\t\t\t\t//親がDL\n\t\t\t\t\tfor(i = 0, l = wrapper.childNodes.length; i < l; i++){\n\t\t\t\t\t\tvar p = document.createElement('p');\n\t\t\t\t\t\tp.innerHTML = wrapper.childNodes[i].innerHTML;\n\t\t\t\t\t\tthis.dom.insertAfter(p, wrapper);\n\t\t\t\t\t}\n\t\t\t\t\tthis.dom.remove(wrapper);\n\t\t\t\t}else{\n\t\t\t\t\t//まだDLじゃない\n\t\t\t\t\tif(this.selection.getContent().length > 0){\n\t\t\t\t\t\tvar dl = this.dom.create('dl');\n\t\t\t\t\t\tif(startNode == endNode){\n\t\t\t\t\t\t\t//一つの要素が選択されている\n\t\t\t\t\t\t\tthis.dom.rename(startNode, 'dt');\n\t\t\t\t\t\t\tdl.appendChild(startNode);\n\t\t\t\t\t\t\tthis.selection.setNode(dl);\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t//2つ以上の要素が選択されている\n\t\t\t\t\t\t\tvar currentNode = startNode;\n\t\t\t\t\t\t\tvar d = this.dom;\n\t\t\t\t\t\t\tfor(i = 0; true;){\n\t\t\t\t\t\t\t\tthis.dom.add(dl, (i % 2 == 0 ? 'DT' : 'DD'), {}, currentNode.innerHTML);\n\t\t\t\t\t\t\t\t\ti++;\n\t\t\t\t\t\t\t\tif(currentNode == endNode || !(currentNode = this.dom.getNext(currentNode, function(node){\n\t\t\t\t\t\t\t\t\t\treturn node && d.isBlock(node);\n\t\t\t\t\t\t\t\t\t})) || i > 100){\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.selection.setNode(dl);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\teditor.addButton(\"dl\",{\n\t\t\t\ttitle: \"yomigana_dlg.dlTitle\",\n\t\t\t\tcmd: \"DL\",\n\t\t\t\timage: url + '/img/dl.png'\n\t\t\t});\n\t\t\t//キャレットの移動\n\t\t\teditor.onNodeChange.add(function(e,d,g,f){\n\t\t\t\tg = e.dom.getParent(g,\"RUBY,SMALL,Q,DL\");\n\t\t\t\td.setDisabled(\"ruby\",f);\n\t\t\t\td.setActive(\"ruby\",0);\n\t\t\t\td.setDisabled(\"small\",f);\n\t\t\t\td.setActive(\"small\",0);\n\t\t\t\td.setDisabled(\"q\",f);\n\t\t\t\td.setActive(\"q\",0);\n\t\t\t\tif(g){\n\t\t\t\t\tdo{\n\t\t\t\t\t\td.setDisabled(g.nodeName.toLowerCase(),0);\n\t\t\t\t\t\td.setActive(g.nodeName.toLowerCase(),1);\n\t\t\t\t\t}while(g = g.parentNode);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\t\n\ttinymce.PluginManager.add(\"yomigana\",tinymce.plugins.yomigana);\n})();"]}