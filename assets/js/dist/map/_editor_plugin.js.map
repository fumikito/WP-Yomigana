{"version":3,"sources":["_editor_plugin.js"],"names":["tinymce","create","getInfo","longname","author","authorurl","infourl","version","init","editor","url","addCommand","focus","ieBookmark","selection","getBookmark","windowManager","open","file","width","height","inline","plugin_url","addButton","title","cmd","image","target","this","getNode","nodeName","txt","document","createTextNode","innerHTML","dom","replace","getContent","length","newDom","setHTML","setNode","wrapper","startNode","getStart","endNode","getEnd","getParent","tagName","i","l","childNodes","p","createElement","insertAfter","remove","dl","rename","appendChild","currentNode","d","add","getNext","node","isBlock","onNodeChange","e","g","f","setDisabled","setActive","toLowerCase","parentNode","PluginManager","plugins","yomigana"],"mappings":"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","file":"_editor_plugin.js","sourcesContent":["(function(){\n\t\n\t\n\ttinymce.create(\"tinymce.plugins.yomigana\",{\n\t\t\n\t\tgetInfo:function(){\n\t\t\treturn{\n\t\t\t\tlongname:\"Yomigana\",\n\t\t\t\tauthor:\"Takahashi Fumiki\",\n\t\t\t\tauthorurl:\"http://takahashifumiki.com\",\n\t\t\t\tinfourl:\"https://wordpress.org/plugins/wp-yomigana/\",\n\t\t\t\tversion:\"1.0\"\n\t\t\t};\n\t\t},\n\t\t\n\t\tinit:function(editor,url){\n\t\t\t//ルビ\n\t\t\teditor.addCommand(\"Ruby\",function(){\n\t\t\t\teditor.focus();\n\t\t\t\teditor.ieBookmark = editor.selection.getBookmark(1);\n\t\t\t\teditor.windowManager.open(\n\t\t\t\t\t{\n\t\t\t\t\t\tfile: url + \"/ruby.php\",\n\t\t\t\t\t\twidth: 350,\n\t\t\t\t\t\theight:150,\n\t\t\t\t\t\tinline: 1\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tplugin_url: url\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t});\n\t\t\teditor.addButton(\"ruby\",{\n\t\t\t\ttitle:\"yomigana_dlg.rubyTitle\",\n\t\t\t\tcmd:\"Ruby\",\n\t\t\t\timage: url + \"/img/ruby.gif\"\n\t\t\t});\n\t\t\t//qタグ\n\t\t\teditor.addCommand('inlineQ', function(){\n\t\t\t\teditor.focus();\n\t\t\t\teditor.ieBookmark = editor.selection.getBookmark(1);\n\t\t\t\teditor.windowManager.open({\n\t\t\t\t\tfile: url + '/q.php',\n\t\t\t\t\twidth: 350,\n\t\t\t\t\theight: 150,\n\t\t\t\t\tinline: 1\n\t\t\t\t},{\n\t\t\t\t\tplugin_url: url\n\t\t\t\t});\n\t\t\t});\n\t\t\teditor.addButton(\"q\", {\n\t\t\t\ttitle: \"yomigana_dlg.qTitle\",\n\t\t\t\tcmd: 'inlineQ',\n\t\t\t\timage: url + '/img/q.png'\n\t\t\t});\n\t\t\t//small\n\t\t\teditor.addCommand(\"Small\", function(){\n\t\t\t\tvar target = this.selection.getNode();\n\t\t\t\tif(target.nodeName == 'SMALL'){\n\t\t\t\t\t//ノード名がSmallだったら外す\n\t\t\t\t\tvar txt = document.createTextNode(target.innerHTML);\n\t\t\t\t\tthis.dom.replace(txt, target, false);\n\t\t\t\t}else if(this.selection.getContent().length > 0){\n\t\t\t\t\t//一文字以上選択されていたらsmallでWrapする\n\t\t\t\t\tvar newDom = this.dom.create('small');\n\t\t\t\t\tthis.dom.setHTML(newDom, this.selection.getContent());\n\t\t\t\t\tthis.selection.setNode(newDom);\n\t\t\t\t}\n\t\t\t});\n\t\t\teditor.addButton(\"small\",{\n\t\t\t\ttitle: \"yomigana_dlg.smallTitle\",\n\t\t\t\tcmd: 'Small',\n\t\t\t\timage: url + '/img/small.png'\n\t\t\t});\n\t\t\teditor.addCommand('DL', function(){\n\t\t\t\tvar startNode = this.selection.getStart();\n\t\t\t\tvar endNode = this.selection.getEnd();\n\t\t\t\tvar wrapper;\n\t\t\t\tif(this.dom.getParent(startNode, 'DL')){\n\t\t\t\t\twrapper = this.dom.getParent(startNode, 'DL');\n\t\t\t\t}else if(this.selection.getNode().tagName == 'DL'){\n\t\t\t\t\twrapper = this.selection.getNode();\n\t\t\t\t}\n\t\t\t\tif(wrapper){\n\t\t\t\t\t//親がDL\n\t\t\t\t\tfor(i = 0, l = wrapper.childNodes.length; i < l; i++){\n\t\t\t\t\t\tvar p = document.createElement('p');\n\t\t\t\t\t\tp.innerHTML = wrapper.childNodes[i].innerHTML;\n\t\t\t\t\t\tthis.dom.insertAfter(p, wrapper);\n\t\t\t\t\t}\n\t\t\t\t\tthis.dom.remove(wrapper);\n\t\t\t\t}else{\n\t\t\t\t\t//まだDLじゃない\n\t\t\t\t\tif(this.selection.getContent().length > 0){\n\t\t\t\t\t\tvar dl = this.dom.create('dl');\n\t\t\t\t\t\tif(startNode == endNode){\n\t\t\t\t\t\t\t//一つの要素が選択されている\n\t\t\t\t\t\t\tthis.dom.rename(startNode, 'dt');\n\t\t\t\t\t\t\tdl.appendChild(startNode);\n\t\t\t\t\t\t\tthis.selection.setNode(dl);\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t//2つ以上の要素が選択されている\n\t\t\t\t\t\t\tvar currentNode = startNode;\n\t\t\t\t\t\t\tvar d = this.dom;\n\t\t\t\t\t\t\tfor(i = 0; true;){\n\t\t\t\t\t\t\t\tthis.dom.add(dl, (i % 2 == 0 ? 'DT' : 'DD'), {}, currentNode.innerHTML);\n\t\t\t\t\t\t\t\t\ti++;\n\t\t\t\t\t\t\t\tif(currentNode == endNode || !(currentNode = this.dom.getNext(currentNode, function(node){\n\t\t\t\t\t\t\t\t\t\treturn node && d.isBlock(node);\n\t\t\t\t\t\t\t\t\t})) || i > 100){\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.selection.setNode(dl);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\teditor.addButton(\"dl\",{\n\t\t\t\ttitle: \"yomigana_dlg.dlTitle\",\n\t\t\t\tcmd: \"DL\",\n\t\t\t\timage: url + '/img/dl.png'\n\t\t\t});\n\t\t\t//キャレットの移動\n\t\t\teditor.onNodeChange.add(function(e,d,g,f){\n\t\t\t\tg = e.dom.getParent(g,\"RUBY,SMALL,Q,DL\");\n\t\t\t\td.setDisabled(\"ruby\",f);\n\t\t\t\td.setActive(\"ruby\",0);\n\t\t\t\td.setDisabled(\"small\",f);\n\t\t\t\td.setActive(\"small\",0);\n\t\t\t\td.setDisabled(\"q\",f);\n\t\t\t\td.setActive(\"q\",0);\n\t\t\t\tif(g){\n\t\t\t\t\tdo{\n\t\t\t\t\t\td.setDisabled(g.nodeName.toLowerCase(),0);\n\t\t\t\t\t\td.setActive(g.nodeName.toLowerCase(),1);\n\t\t\t\t\t}while(g = g.parentNode);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\t\n\ttinymce.PluginManager.add(\"yomigana\",tinymce.plugins.yomigana);\n})();"],"sourceRoot":"/source/"}